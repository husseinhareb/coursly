{% extends 'base.html.twig' %}

{% block title %}{{ 'courses.my.title'|trans }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('styles/course.css') }}">
{% endblock %}

{% block body %}
<div class="courses-page">
    <div class="courses-header-container">
        <h1 class="page-title">{{ 'courses.my.heading'|trans }}</h1>
        <a href="{{ path('courses_new') }}" class="btn-add-courses">{{ 'courses.my.add_course'|trans }}</a>
    </div>

    <div class="search-bar">
        <input type="text" id="search" class="search-input" placeholder="{{ 'courses.my.search_placeholder'|trans }}">
    </div>

    <div class="courses-grid">
        {% for course in courses %}
            {% set bg = colors[loop.index0 % colors|length] %}
            <div class="courses-card">
                {% if bg|slice(0, 1) == '#' %}
                    <div class="courses-header" style="background-color: {{ bg }};"></div>
                {% else %}
                    <div class="courses-header" style="background-image: url('{{ asset('uploads/course_pics/' ~ bg) }}');"></div>
                {% endif %}
                <div class="courses-content">
                    <h5 class="courses-title">
                        <a href="{{ path('courses_show', { id: course.id, code: course.code }) }}">
                            {{ course.title }}
                        </a>
                    </h5>
                    <p class="courses-subtitle">{{ course.code }}</p>
                    <a href="{{ path('courses_edit', { id: course.id }) }}" class="btn-edit">{{ 'courses.my.edit'|trans }}</a>
                </div>
            </div>
        {% else %}
            <p class="no-courses-message">{{ 'courses.my.no_courses'|trans }}</p>
        {% endfor %}
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    let searchInput = document.getElementById("search");

    searchInput.addEventListener("input", function () {
        let query = this.value.toLowerCase().trim();
        let cards = document.querySelectorAll(".courses-card");

        // Debug: log the current query
        console.debug("Search query:", query);

        cards.forEach(card => {
            let titleElement = card.querySelector(".courses-title");
            let subtitleElement = card.querySelector(".courses-subtitle");

            let titleText = titleElement ? titleElement.textContent.toLowerCase().trim() : '';
            let codeText = subtitleElement ? subtitleElement.textContent.toLowerCase().trim() : '';
            let combinedText = titleText + " " + codeText;

            // Debug: log the combined text of the card
            console.debug("Card text:", combinedText);

            card.style.display = combinedText.includes(query) ? "block" : "none";
        });
    });
});
</script>
{% endblock %}
