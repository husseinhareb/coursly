{# templates/courses/course.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}{{ course.title }}{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" href="{{ asset('styles/course.css') }}">

  {# ⚠ If Font-Awesome is already included globally in your layout, delete the line below. #}
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-u3sJg4w0R7G7kI6b6uWkrGgF1V6p7mC1HcbxA4fTxib0f/6Ck6UqjQ6kKD5pXy4y1CrO+6kdDk5JIq4Cs7YmgA=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
{% endblock %}

{% block body %}
<div class="course-page-container">
  <header class="course-header">
    <h1 class="course-title">{{ course.title }}</h1>

    {% if is_granted('ROLE_PROFESSOR') %}
      <a href="{{ path('post_new', { id: course.id, code: course.code }) }}"
         class="btn create-post-btn">
        <i class="fa-solid fa-plus"></i>&nbsp;{{ 'course.show.new_post'|trans }}
      </a>
    {% endif %}
  </header>

  <section class="posts-section">
    <h2>{{ 'course.show.posts_heading'|trans }}</h2>

    <ul class="posts-list">
      {# posts come pre-sorted (pinned first, then position ASC) #}
      {% for post in posts %}
        <li id="post-{{ post.id }}"
            class="post-item{% if post.isPinned %} pinned{% endif %}"
            data-position="{{ post.position }}">

          <div class="post-icons">
            {% if post.isPinned %}
              <span class="pin-icon" title="{{ 'Pinned'|trans }}">
                <i class="fa-solid fa-thumbtack"></i>
              </span>
            {% endif %}
            {% if post.category %}
              <span class="category-label">{{ post.category.name|trans }}</span>
            {% endif %}
          </div>

          <div class="post-header">
            <strong class="post-title">{{ post.title }}</strong>
            <span class="post-type">({{ post.type|trans }})</span>
          </div>

          <div class="post-content">{{ post.content|raw }}</div>

          {% if post.type == 'file' and post.filePath %}
            <a class="post-download"
               href="{{ asset('uploads/post_files/' ~ post.filePath) }}">
              <i class="fa-solid fa-file-arrow-down"></i>&nbsp;
              {{ 'course.show.download_file'|trans }}
            </a>
          {% endif %}

          <div class="post-date">
            <small>
              {{ 'course.show.posted_on'|trans({ '%date%': post.createdAt|date('Y-m-d H:i') }) }}
            </small>
          </div>

          {% if is_granted('ROLE_PROFESSOR') %}
            <div class="post-actions">

              {# ── Pin / Un-pin ── #}
            <button type="button"
                    class="btn-pin"
                    data-post-id="{{ post.id }}"
                    data-is-pinned="{{ post.isPinned ? 1 : 0 }}"
                    title="{{ post.isPinned ? 'Unpin'|trans : 'Pin'|trans }}">

            <i class="fa-solid {{ post.isPinned ? 'fa-thumbtack-slash' : 'fa-thumbtack' }}"></i>
            </button>

              {# ── Move up / down ── #}
                {% if not post.isPinned %}
                <button type="button"
                        class="btn-move-up"
                        data-post-id="{{ post.id }}"
                        title="{{ 'Move up'|trans }}">
                    <i class="fa-solid fa-arrow-up"></i>
                </button>

                <button type="button"
                        class="btn-move-down"
                        data-post-id="{{ post.id }}"
                        title="{{ 'Move down'|trans }}">
                    <i class="fa-solid fa-arrow-down"></i>
                </button>
                {% endif %}

              {# ── Inline-edit & Delete ── #}
              <button type="button"
                      class="btn-edit-inline"
                      data-post-id="{{ post.id }}"
                      title="{{ 'course.show.edit_inline'|trans }}">
                <i class="fa-solid fa-pen"></i>
              </button>

              <button type="button"
                      class="btn-delete"
                      data-post-id="{{ post.id }}"
                      title="{{ 'course.show.delete'|trans }}">
                <i class="fa-solid fa-trash"></i>
              </button>
            </div>
          {% endif %}
        </li>
      {% else %}
        <li class="no-posts">{{ 'course.show.no_posts'|trans }}</li>
      {% endfor %}
    </ul>
  </section>
</div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script src="{{ asset('js/posts.js') }}" defer></script>
{% endblock %}
